!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t="undefined"!=typeof globalThis?globalThis:t||self).ll1={})}(this,(function(t){"use strict";function r(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}function n(t,n){if(t){if("string"==typeof t)return r(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(t,n):void 0}}function e(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var e,o,i,a,u=[],f=!0,l=!1;try{if(i=(n=n.call(t)).next,0===r){if(Object(n)!==n)return;f=!1}else for(;!(f=(e=i.call(n)).done)&&(u.push(e.value),u.length!==r);f=!0);}catch(t){l=!0,o=t}finally{try{if(!f&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw o}}return u}}(t,r)||n(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t){return function(t){if(Array.isArray(t))return r(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var i=null,a="|",u="$";function f(t,r){return new Set([].concat(o(t),o(r)))}function l(t){return" "===t||"\t"===t||"\n"===t||"\r"===t}function c(t){for(var r=[],n=new Map,o=0;o<t.length;++o){var a=e(t[o].split("->"),2),u=a[0],f=a[1];if(!f||!f.trim())throw new Error("Grammar is missing the right side");var c=!0;n.has(u)||(c=!1,n.set(u,{left:null,right:[]}));var h=n.get(u);h.left=u.trim();var s=[],v="";f+=" ";for(var p=0;p<f.length;++p){var d=f[p];l(d)?("null"===v?s.push(i):v&&s.push(v),v=""):"|"===d?(h.right.push(s),s=[],v=""):v+=d}s.length&&h.right.push(s),!c&&r.push(h)}return r}function h(t,r){var n,e=function(t){return r.includes(t)||t===i},a={};t.forEach((function(t){var r=t.left;return a[r]=[]}));do{n=!1,t.forEach((function(t){var r=t.left,l=t.right,c=new Set(a[r]),h=c.size;l.forEach((function(t){for(var r=0,n=t[r];(null===(o=n)||void 0===o?void 0:o[0])===u;){var o;n=t[++r]}if(e(n))c.add(n);else if(a[n].includes(i)){do{var l,h=new Set(a[n]);for(h.delete(i),c=f(c,h),n=t[r+=1];(null===(s=n)||void 0===s?void 0:s[0])===u;){var s;n=t[++r]}}while(null!==(l=a[n])&&void 0!==l&&l.includes(i));e(n)?c.add(n):n&&(c=f(c,a[n]))}else c=f(c,a[n])})),a[r]=o(c),h!==c.size&&(n=!0)}))}while(n);return a}function s(t,r,n){var e=[];return t.some((function(t){if(t[0]===u)return!1;if(function(t){return n.includes(t)||t===i}(t))e.push(t);else{if(r[t].includes(i))return!1;e.push.apply(e,o(r[t]))}return!0})),e}function v(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h(t,r),e=function(t){return r.includes(t)||t===i},a={};t.forEach((function(t){var r=t.left;return a[r]=[]})),a[t[0].left].push(u);var l,c=new Set;for(var s in n)n[s].includes(i)&&c.add(s);do{l=!1,t.forEach((function(t){var r=t.left;t.right.forEach((function(t){for(var h=t.length-1;h>=0;--h){var s=t[h];if(!e(s)&&s[0]!==u){var v=a[s].length;if(h===t.length-1)a[s]=o(f(a[s],a[r]));else{for(var p=h+1,d=t[p];p<t.length&&d[0]===u;)d=t[++p];if(e(d))a[s]=o(f(a[s],[d]));else{var y=new Set(n[d]);for(y.delete(i),a[s]=o(f(a[s],y));p<t.length&&(c.has(d)||d[0]===u);)d=t[++p];p===t.length&&(a[s]=o(f(a[s],a[r])))}}a[s].length!==v&&(l=!0)}}}))}))}while(l);return a}function p(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,r){if(!t)return;if("string"==typeof t)return d(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(t,r)}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var e=0,o=function(){};return{s:o,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function d(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}function y(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:h(t,r),e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:v(t,r),o=new Map;return t.forEach((function(t){var a=t.left;t.right.forEach((function(t){for(var f=0,l=t[f],c={left:a,right:t};f<t.length&&l&&l[0]===u;)l=t[++f];l===i?o.set(c,e[a]):o.set(c,s(t,n,r))}))})),o}function g(t){var r,n=new Map,o=p(t);try{for(o.s();!(r=o.n()).done;){var i=e(r.value,2),a=i[0].left,u=i[1];if(n.has(a)){var l=n.get(a),c=f(l,u);if(c.size!==l.size+u.length)return!1;n.set(a,c)}else n.set(a,new Set(u))}}catch(t){o.e(t)}finally{o.f()}return!0}function m(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,r){if(!t)return;if("string"==typeof t)return b(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(t,r)}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var e=0,o=function(){};return{s:o,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function b(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}function w(t){if(!g(t))throw new Error("Select set does not satisfy the LL(1) grammar");var r,n=new Map,o=m(t);try{var i=function(){var t=e(r.value,2),o=t[0],i=o.left,a=o.right;t[1].forEach((function(t){n.has(t)||n.set(t,new Map),n.get(t).set(i,a)}))};for(o.s();!(r=o.n()).done;)i()}catch(t){o.e(t)}finally{o.f()}return n}function S(t,r){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,r){if(!t)return;if("string"==typeof t)return A(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(t,r)}(t))||r&&t&&"number"==typeof t.length){n&&(t=n);var e=0,o=function(){};return{s:o,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(u)throw i}}}}function A(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}t.$=u,t.EMPTY_CHAIN=i,t.clearLeftRecursion=function(t){var r=[];return t.forEach((function(t){r.push.apply(r,o(function(t){var r=t.left,n=t.right,e=[],o="".concat(r,"`"),a=[],u=[],f=!1;n.forEach((function(t){t[0]===r?(t.shift(),t.push(o),a.push(t)):t[0]===i?f=!0:(t.push(o),u.push(t))})),f&&u.push([o]);return e.push({left:r,right:[].concat(u)},{left:o,right:[].concat(a,[[i]])}),e}(t)))})),r},t.combineLikeTerms=function(t){var r=function(t){return t.join(a)},n=[],e=new Map;function u(t,f){e.set(r(f),t);var l,c,h=0,s=!1,v={left:t,right:[]};if(1===f.length)return v.right=function(t){return o(t.map((function(t){return o(t)})))}(f),void n.push(v);for(var p=[],d=0;d<f.length;++d)if(!p.includes(d)){if(p.push(d),d===f.length-1)return void v.right.push(f[d]);var y=f[d],g=0,m=[];m.push(y),l="";t:for(;g<y.length;){c=y[g];var b=!1;if(0===g)for(var w=d+1;w<f.length;++w){var S=f[w][g];S&&(S===c&&(b=!0,p.push(w),m.push(f[w])))}else for(var A=d+1;A<f.length;++A){var E=f[A][g];E&&E===c&&p.includes(A)&&(b=!0)}if(!b)break t;l+=c+a,g++}if(l){var j=m.map((function(t){var r=t.slice(l.slice(0,-1).split(a).length);return r.length?r:[i]})),I=void 0;I=e.has(r(j))?e.get(r(j)):"".concat(t).concat("'".repeat(h),"'");var M=[].concat(o(l.slice(0,-1).split(a)),[I]);v.right.push(M),s||(n.push(v),h++),e.has(r(j))||u(I,j)}else v.right.push(o(f[d])),s||n.push(v);s=!0}}return t.forEach((function(t){var n=t.left,o=t.right;e.set(r(o),n)})),t.forEach((function(t){u(t.left,t.right)})),n},t.isNotIntersect=g,t.makeFirstSet=h,t.makeFollowSet=v,t.makeLL1=function(t,r){var n=c(t),o=h(n,r),i=v(n,r,o),a=y(n,r,o,i),u=w(a);return{startSymbol:n[0].left,firstSet:o,followSet:i,selectSet:a,predictSet:u,print:function(){var t,r=[],n=[],i=2,a=S(u);try{for(a.s();!(t=a.n()).done;){var f=e(t.value,1)[0];n.push(f),i=Math.max(i,f.length+2)}}catch(t){a.e(t)}finally{a.f()}for(var l in o)r.push(l),i=Math.max(i,l.length+2);for(var c=new Array(r.length+1).fill([]).map((function(){return new Array(n.length+1).fill("")})),h=0;h<n.length;++h)c[0][h+1]=n[h];for(var s=0;s<r.length;++s)c[s+1][0]=r[s];var v,p=S(u);try{for(p.s();!(v=p.n()).done;){var d,y=e(v.value,2),g=y[0],m=y[1],b=c[0].indexOf(g),w=void 0,A=S(m);try{for(A.s();!(d=A.n()).done;){for(var E=e(d.value,2),j=E[0],I=E[1],M=0;M<r.length;++M)if(c[M+1][0]===j){w=M+1;break}c[w][b]="-> ".concat(I.map((function(t){return t+""})).join(" ")),i=Math.max(i,c[w][b].length+2)}}catch(t){A.e(t)}finally{A.f()}}}catch(t){p.e(t)}finally{p.f()}for(var x="",O="\n"+("|"+"-".repeat(i+2)).repeat(n.length+1)+"|\n",k=0;k<c.length;++k){x+=O+"|";for(var T=0;T<c[k].length;++T){var L=0===k||0===T?" [33;1m "+c[k][T]+" [0m ":" [32;1m "+c[k][T]+" [0m ";x+=L+" ".repeat(i+13-L.length)+"|"}}x+=O,console.log(x)}}},t.makePredictSet=w,t.makeSelectSet=y,t.makeUnionFirstSet=s,t.splitGrammars=c,t.toGrammars=function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[];return t.forEach((function(t){var e=t.left,o=t.right;if(r)o.forEach((function(t){var r="";r+="".concat(e," -> ").concat(t.map((function(t){return t+""})).join(" ")),n.push(r)}));else{var i="";i+="".concat(e," -> "),o.forEach((function(t){i+=t.map((function(t){return t+""})).join(" ")+" ".concat(a," ")})),n.push(i.slice(0,-3))}})),n}}));
