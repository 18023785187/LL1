"use strict";function r(r,t){(null==t||t>r.length)&&(t=r.length);for(var n=0,e=new Array(t);n<t;n++)e[n]=r[n];return e}function t(t,n){if(t){if("string"==typeof t)return r(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?r(t,n):void 0}}function n(r,n){return function(r){if(Array.isArray(r))return r}(r)||function(r,t){var n=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=n){var e,o,a,i,u=[],f=!0,l=!1;try{if(a=(n=n.call(r)).next,0===t){if(Object(n)!==n)return;f=!1}else for(;!(f=(e=a.call(n)).done)&&(u.push(e.value),u.length!==t);f=!0);}catch(r){l=!0,o=r}finally{try{if(!f&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return u}}(r,n)||t(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(n){return function(t){if(Array.isArray(t))return r(t)}(n)||function(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(n)||t(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var o=null,a="|",i="$";function u(r,t){return new Set([].concat(e(r),e(t)))}function f(r){return" "===r||"\t"===r||"\n"===r||"\r"===r}function l(r){for(var t=[],e=new Map,a=0;a<r.length;++a){var i=n(r[a].split("->"),2),u=i[0],l=i[1];if(!l||!l.trim())throw new Error("Grammar is missing the right side");var c=!0;e.has(u)||(c=!1,e.set(u,{left:null,right:[]}));var s=e.get(u);s.left=u.trim();var h=[],v="";l+=" ";for(var p=0;p<l.length;++p){var g=l[p];f(g)?("null"===v?h.push(o):v&&h.push(v),v=""):"|"===g?(s.right.push(h),h=[],v=""):v+=g}h.length&&s.right.push(h),!c&&t.push(s)}return t}function c(r,t){var n,a=function(r){return t.includes(r)||r===o},f={};r.forEach((function(r){var t=r.left;return f[t]=[]}));do{n=!1,r.forEach((function(r){var t=r.left,l=r.right,c=new Set(f[t]),s=c.size;l.forEach((function(r){for(var t=0,n=r[t];(null===(e=n)||void 0===e?void 0:e[0])===i;){var e;n=r[++t]}if(a(n))c.add(n);else if(f[n].includes(o)){do{var l,s=new Set(f[n]);for(s.delete(o),c=u(c,s),n=r[t+=1];(null===(h=n)||void 0===h?void 0:h[0])===i;){var h;n=r[++t]}}while(null!==(l=f[n])&&void 0!==l&&l.includes(o));a(n)?c.add(n):n&&(c=u(c,f[n]))}else c=u(c,f[n])})),f[t]=e(c),s!==c.size&&(n=!0)}))}while(n);return f}function s(r,t,n){var a=[];return r.some((function(r){if(r[0]===i)return!1;if(function(r){return n.includes(r)||r===o}(r))a.push(r);else{if(t[r].includes(o))return!1;a.push.apply(a,e(t[r]))}return!0})),a}function h(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c(r,t),a=function(r){return t.includes(r)||r===o},f={};r.forEach((function(r){var t=r.left;return f[t]=[]})),f[r[0].left].push(i);var l,s=new Set;for(var h in n)n[h].includes(o)&&s.add(h);do{l=!1,r.forEach((function(r){var t=r.left;r.right.forEach((function(r){for(var c=r.length-1;c>=0;--c){var h=r[c];if(!a(h)&&h[0]!==i){var v=f[h].length;if(c===r.length-1)f[h]=e(u(f[h],f[t]));else{for(var p=c+1,g=r[p];p<r.length&&g[0]===i;)g=r[++p];if(a(g))f[h]=e(u(f[h],[g]));else{var y=new Set(n[g]);for(y.delete(o),f[h]=e(u(f[h],y));p<r.length&&(s.has(g)||g[0]===i);)g=r[++p];p===r.length&&(f[h]=e(u(f[h],f[t])))}}f[h].length!==v&&(l=!0)}}}))}))}while(l);return f}function v(r,t){var n="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!n){if(Array.isArray(r)||(n=function(r,t){if(!r)return;if("string"==typeof r)return p(r,t);var n=Object.prototype.toString.call(r).slice(8,-1);"Object"===n&&r.constructor&&(n=r.constructor.name);if("Map"===n||"Set"===n)return Array.from(r);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(r,t)}(r))||t&&r&&"number"==typeof r.length){n&&(r=n);var e=0,o=function(){};return{s:o,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(r){throw r},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){n=n.call(r)},n:function(){var r=n.next();return i=r.done,r},e:function(r){u=!0,a=r},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw a}}}}function p(r,t){(null==t||t>r.length)&&(t=r.length);for(var n=0,e=new Array(t);n<t;n++)e[n]=r[n];return e}function g(r,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:c(r,t),e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:h(r,t),a=new Map;return r.forEach((function(r){var u=r.left;r.right.forEach((function(r){for(var f=0,l=r[f],c={left:u,right:r};f<r.length&&l&&l[0]===i;)l=r[++f];l===o?a.set(c,e[u]):a.set(c,s(r,n,t))}))})),a}function y(r){var t,e=new Map,o=v(r);try{for(o.s();!(t=o.n()).done;){var a=n(t.value,2),i=a[0].left,f=a[1];if(e.has(i)){var l=e.get(i),c=u(l,f);if(c.size!==l.size+f.length)return!1;e.set(i,c)}else e.set(i,new Set(f))}}catch(r){o.e(r)}finally{o.f()}return!0}function d(r,t){var n="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!n){if(Array.isArray(r)||(n=function(r,t){if(!r)return;if("string"==typeof r)return m(r,t);var n=Object.prototype.toString.call(r).slice(8,-1);"Object"===n&&r.constructor&&(n=r.constructor.name);if("Map"===n||"Set"===n)return Array.from(r);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return m(r,t)}(r))||t&&r&&"number"==typeof r.length){n&&(r=n);var e=0,o=function(){};return{s:o,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(r){throw r},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){n=n.call(r)},n:function(){var r=n.next();return i=r.done,r},e:function(r){u=!0,a=r},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw a}}}}function m(r,t){(null==t||t>r.length)&&(t=r.length);for(var n=0,e=new Array(t);n<t;n++)e[n]=r[n];return e}function b(r){if(!y(r))throw new Error("Select set does not satisfy the LL(1) grammar");var t,e=new Map,o=d(r);try{var a=function(){var r=n(t.value,2),o=r[0],a=o.left,i=o.right;r[1].forEach((function(r){e.has(r)||e.set(r,new Map),e.get(r).set(a,i)}))};for(o.s();!(t=o.n()).done;)a()}catch(r){o.e(r)}finally{o.f()}return e}function w(r,t){var n="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!n){if(Array.isArray(r)||(n=function(r,t){if(!r)return;if("string"==typeof r)return S(r,t);var n=Object.prototype.toString.call(r).slice(8,-1);"Object"===n&&r.constructor&&(n=r.constructor.name);if("Map"===n||"Set"===n)return Array.from(r);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(r,t)}(r))||t&&r&&"number"==typeof r.length){n&&(r=n);var e=0,o=function(){};return{s:o,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(r){throw r},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,u=!1;return{s:function(){n=n.call(r)},n:function(){var r=n.next();return i=r.done,r},e:function(r){u=!0,a=r},f:function(){try{i||null==n.return||n.return()}finally{if(u)throw a}}}}function S(r,t){(null==t||t>r.length)&&(t=r.length);for(var n=0,e=new Array(t);n<t;n++)e[n]=r[n];return e}exports.$=i,exports.EMPTY_CHAIN=o,exports.clearLeftRecursion=function(r){var t=[];return r.forEach((function(r){t.push.apply(t,e(function(r){var t=r.left,n=r.right,e=[],a="".concat(t,"`"),i=[],u=[],f=!1;n.forEach((function(r){r[0]===t?(r.shift(),r.push(a),i.push(r)):r[0]===o?f=!0:(r.push(a),u.push(r))})),f&&u.push([a]);return e.push({left:t,right:[].concat(u)},{left:a,right:[].concat(i,[[o]])}),e}(r)))})),t},exports.combineLikeTerms=function(r){var t=function(r){return r.join(a)},n=[],i=new Map;function u(r,f){i.set(t(f),r);var l,c,s=0,h=!1,v={left:r,right:[]};if(1===f.length)return v.right=function(r){return e(r.map((function(r){return e(r)})))}(f),void n.push(v);for(var p=[],g=0;g<f.length;++g)if(!p.includes(g)){if(p.push(g),g===f.length-1)return void v.right.push(f[g]);var y=f[g],d=0,m=[];m.push(y),l="";r:for(;d<y.length;){c=y[d];var b=!1;if(0===d)for(var w=g+1;w<f.length;++w){var S=f[w][d];S&&(S===c&&(b=!0,p.push(w),m.push(f[w])))}else for(var A=g+1;A<f.length;++A){var E=f[A][d];E&&E===c&&p.includes(A)&&(b=!0)}if(!b)break r;l+=c+a,d++}if(l){var x=m.map((function(r){var t=r.slice(l.slice(0,-1).split(a).length);return t.length?t:[o]})),j=void 0;j=i.has(t(x))?i.get(t(x)):"".concat(r).concat("'".repeat(s),"'");var I=[].concat(e(l.slice(0,-1).split(a)),[j]);v.right.push(I),h||(n.push(v),s++),i.has(t(x))||u(j,x)}else v.right.push(e(f[g])),h||n.push(v);h=!0}}return r.forEach((function(r){var n=r.left,e=r.right;i.set(t(e),n)})),r.forEach((function(r){u(r.left,r.right)})),n},exports.isNotIntersect=y,exports.makeFirstSet=c,exports.makeFollowSet=h,exports.makeLL1=function(r,t){var e=l(r),o=c(e,t),a=h(e,t,o),i=g(e,t,o,a),u=b(i);return{startSymbol:e[0].left,firstSet:o,followSet:a,selectSet:i,predictSet:u,print:function(){var r,t=[],e=[],a=2,i=w(u);try{for(i.s();!(r=i.n()).done;){var f=n(r.value,1)[0];e.push(f),a=Math.max(a,f.length+2)}}catch(r){i.e(r)}finally{i.f()}for(var l in o)t.push(l),a=Math.max(a,l.length+2);for(var c=new Array(t.length+1).fill([]).map((function(){return new Array(e.length+1).fill("")})),s=0;s<e.length;++s)c[0][s+1]=e[s];for(var h=0;h<t.length;++h)c[h+1][0]=t[h];var v,p=w(u);try{for(p.s();!(v=p.n()).done;){var g,y=n(v.value,2),d=y[0],m=y[1],b=c[0].indexOf(d),S=void 0,A=w(m);try{for(A.s();!(g=A.n()).done;){for(var E=n(g.value,2),x=E[0],j=E[1],I=0;I<t.length;++I)if(c[I+1][0]===x){S=I+1;break}c[S][b]="-> ".concat(j.map((function(r){return r+""})).join(" ")),a=Math.max(a,c[S][b].length+2)}}catch(r){A.e(r)}finally{A.f()}}}catch(r){p.e(r)}finally{p.f()}for(var M="",O="\n"+("|"+"-".repeat(a+2)).repeat(e.length+1)+"|\n",k=0;k<c.length;++k){M+=O+"|";for(var T=0;T<c[k].length;++T){var L=0===k||0===T?" [33;1m "+c[k][T]+" [0m ":" [32;1m "+c[k][T]+" [0m ";M+=L+" ".repeat(a+13-L.length)+"|"}}M+=O,console.log(M)}}},exports.makePredictSet=b,exports.makeSelectSet=g,exports.makeUnionFirstSet=s,exports.splitGrammars=l,exports.toGrammars=function(r){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[];return r.forEach((function(r){var e=r.left,o=r.right;if(t)o.forEach((function(r){var t="";t+="".concat(e," -> ").concat(r.map((function(r){return r+""})).join(" ")),n.push(t)}));else{var i="";i+="".concat(e," -> "),o.forEach((function(r){i+=r.map((function(r){return r+""})).join(" ")+" ".concat(a," ")})),n.push(i.slice(0,-3))}})),n};
